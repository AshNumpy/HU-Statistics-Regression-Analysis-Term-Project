---
title: "Regresyon Ã–devi"
author: "Ramazan Erduran 21821809"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Verileri Ä°Ã§eri Aktarma

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(readr)
hwdata <- read_table2("D:/Hacettepe/Regresyon/Ã–dev/hwdata.txt")
head(hwdata)
names(hwdata) <- c("Y", "X1", "X2", "X3", "X4") 
hwdata$X4 <- as.factor(hwdata$X4)
class(hwdata$X4)
```

Verilerimdeki deÄŸiÅŸkenleri **Y, X1, X2, X3 ve X4** olarak isimlendirdim. **X4** deÄŸiÅŸkenini ise `factor` olarak belirttim ki kategorik deÄŸiÅŸkeni uygun bir ÅŸekilde kullanabileyim.

## Part 1. Senaryo

Verilerim Y baÄŸÄ±mlÄ± deÄŸiÅŸkeni, X1, X2, X3 baÄŸÄ±msÄ±z nitel ve X4 baÄŸÄ±msÄ±z 3 katlÄ± kategorik deÄŸiÅŸkenden oluÅŸuyor.

*AraÃ§ satma ve kiralamaya iliÅŸkin bir ÅŸirketimiz olduÄŸunu varsayalÄ±m. 2. el araÃ§lar hem kiralanabiliyor hem de satÄ±labiliyor. SÄ±fÄ±r araÃ§lar ise sadece satÄ±labiliyor kiralamada kullanÄ±lamÄ±yor. AyrÄ±ca Borsa Ä°stanbul 100 endeksine baÄŸlÄ± hisselerimizi halkÄ±n alÄ±m satÄ±mÄ±na aÃ§mÄ±ÅŸ bir ÅŸirket olalÄ±m. Bizim elimizdeki verilerde Y baÄŸÄ±mlÄ± deÄŸiÅŸkenimiz ise tÃ¼m bu sÃ¼reÃ§ten kazandÄ±ÄŸÄ±mÄ±z gelir olsun (MilyonTL). 150 aylÄ±k bir veri setimiz olduÄŸunu dÃ¼ÅŸÃ¼nelim:*

| DEÄÄ°ÅKENLER |               DEÄÄ°ÅKEN SENARYOSU               |
|:-----------:|:----------------------------------------------:|
|      Y      |      Elde edilen toplam gelir (MilyonTL)       |
|     X1      | AraÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir (BinTL) |
|     X2      |    Åirket hisse fiyatlarÄ±ndaki deÄŸiÅŸim (TL)    |
|     X3      |           Enflasyondaki deÄŸiÅŸim (%)            |
|    X4-1     |            LPG ile Ã§alÄ±ÅŸan araÃ§lar             |
|    X4-2     |           Benzin ile Ã§alÄ±ÅŸan araÃ§lar           |
|    X4-3     |           Dizel ile Ã§alÄ±ÅŸan araÃ§lar            |

## Part 2. TanÄ±mlayÄ±cÄ± Ä°statistikler

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
summary(hwdata)
```

150 AylÄ±k veri setinden elde edilen tanÄ±mlayÄ±cÄ± istatistiklere gÃ¶re;

-   Ortalama **Y = Elde edilen ortalama toplam gelir** 13.930 MilyonTL/Ay olarak bulunmuÅŸ.

-   150 AylÄ±k sÃ¼re iÃ§erisindeki ortalama **X1 = AraÃ§ satÄ±ÅŸÄ± ve kiralamalardan gelen gelir** aylÄ±k 7.063 BinTL hesaplanmÄ±ÅŸ.

-   Hisse senetlerimizdeki (**X2 = Åirket hisse fiyatlarÄ±ndaki deÄŸiÅŸim**) durum ise aylÄ±k ortalama 2.030 TL olarak hesaplanmÄ±ÅŸ. (HissedarlarÄ±mÄ±z hisselerini satsaydÄ± eksi deÄŸer alÄ±rdÄ±, tam tersi hisselerimizin alÄ±nmasÄ± ise bize artÄ± deÄŸer kazandÄ±rÄ±rdÄ± bundan dolayÄ± bu deÄŸiÅŸkenimiz hem + hem - deÄŸer alabiliyor.)

-   **X4 = Enflasyondaki deÄŸiÅŸim** deÄŸerlerinin ortalamasÄ±na baktÄ±ÄŸÄ±mÄ±zda ise 150 aylÄ±k sÃ¼reÃ§te enflasyon ortalama %1.0279 artmÄ±ÅŸ.

## Part 3. DoÄŸrusallÄ±k ve Normallik Testi

### Normallik testi:

Normallik testini yapmadan Ã¶nce gÃ¶rsel olarak gÃ¶rebilmek adÄ±na verilerin saÃ§Ä±lÄ±m grafiÄŸi Ã¼zerine normal daÄŸÄ±lÄ±m eÄŸrisi Ã§izip baktÄ±m.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
attach(hwdata)
qqnorm(Y)
qqline(Y)
```

Daha sonra emin olmak iÃ§in sayÄ±sal olarak da kontrol ettim. Bu kÄ±sÄ±mda `shapiro.test()` fonskiyonunu kullandÄ±m.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
shapiro.test(Y)
```

Hipotezlerim;

> H0: Verilerin daÄŸÄ±lÄ±mÄ± ile normal daÄŸÄ±lÄ±m arasÄ±nda fark yoktur.\
> Hs: Verilerin daÄŸÄ±lÄ±mÄ± ile normal daÄŸÄ±lÄ±m arasÄ±nda fark yoktur.**\
> **

Shapiro test sonucumda p-value deÄŸerim $\alpha$ = 0.05 'ten kÃ¼Ã§Ã¼k olduÄŸu iÃ§in yokluk hipotezimi reddedip verilerimin normal daÄŸÄ±lmadÄ±ÄŸÄ± kanÄ±sÄ±na vardÄ±m.

Boxplot grafiÄŸi ile aykÄ±rÄ± deÄŸer var mÄ± ona baktÄ±m. AykÄ±rÄ± deÄŸerleri temizlemenin normal daÄŸÄ±lÄ±m varsayÄ±mÄ±nda bana yardÄ±mcÄ± olabileceÄŸini dÃ¼ÅŸÃ¼ndÃ¼m.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
boxplot(Y)
```

### AykÄ±rÄ± deÄŸer temizliÄŸi:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
Q1 <- quantile(Y, 0.25)
Q3 <- quantile(Y, 0.75)
IQR <- IQR(Y)
hwData <- subset(hwdata, Y > (Q1 - 1.5*IQR) & Y < (Q3 + 1.5*IQR))
boxplot(hwData)
detach(hwdata)
```

AykÄ±rÄ± deÄŸerlerini temizlediÄŸim verilerin normal daÄŸÄ±lÄ±p daÄŸÄ±lmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in tekrardan test yaptÄ±m:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
qqnorm(hwData$Y)
qqline(hwData$Y)
shapiro.test(hwData$Y)
```

Gerek grafikten gerekse `shapiro.test()` sonucunda gÃ¶rebildiÄŸimiz Ã¼zere, p-value: 0.6957 \> $\alpha$=0.05 iÃ§in yokluk hipotezi reddedilir yani %95 gÃ¼venle sÃ¶yelenebilir ki verilerimiz normal daÄŸÄ±lÄ±yor.

### DoÄŸrusallÄ±k:

> *X4 DeÄŸiÅŸkeni kategorik bir deÄŸiÅŸken olduÄŸu iÃ§in doÄŸrusallÄ±k incelemesi yapÄ±lamaz bundan dolayÄ± grafikte yer vermedim.*

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
pairs(hwData[1:4])
```

DaÄŸÄ±lÄ±m grafiklerine baktÄ±ÄŸÄ±mÄ±zda X1 X2 ve X3 deÄŸiÅŸkenleri ile Y arasÄ±nda belli derecede doÄŸrusal bir iliÅŸki olduÄŸunu sÃ¶yleyebiliriz. Ancak burada baÄŸÄ±msÄ±z deÄŸiÅŸkenlerimiz arasÄ±nda Ã¶nemli derecede doÄŸrusal bir iliÅŸki de olabilir. Bundan dolayÄ± BaÄŸÄ±msÄ±z deÄŸiÅŸkenlerim arasÄ±ndaki doÄŸrusallÄ±ÄŸa baktÄ±m:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
result <- lm(hwData$X1~hwData$X2)
a<-summary(result)
sqrt(a$r.squared)
```

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
result <- lm(hwData$X1~hwData$X3)
a<-summary(result)
sqrt(a$r.squared)
```

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
result <- lm(hwData$X2~hwData$X3)
a<-summary(result)
sqrt(a$r.squared)
```

DoÄŸrusallÄ±ÄŸÄ±nÄ± izlediÄŸim ve baÄŸÄ±msÄ±z deÄŸiÅŸkenlerimizin kendi aralarÄ±nda baÄŸÄ±msÄ±z olma konusunda tabloki sonuÃ§larÄ± elde ettim:

| DEÄÄ°ÅKENLER | Ä°LÄ°ÅKÄ° DERECELERÄ° |
|:-----------:|:-----------------:|
| *X1 ile X2* |    *0.7391816*    |
| *X1 ile X3* |    *0.4812473*    |
| *X2 ile X3* |    *0.6856835*    |

Ben burada modelden Ã§Ä±karÄ±p Ã§Ä±karmama veya herhangi bir iÅŸlem yapma konusunda Ã¶nce regresyon analizi yapÄ±p modeldeki anlamlÄ±lÄ±klarÄ±na bakÄ±p daha sonra bu aralarÄ±ndaki doÄŸrusallÄ±ÄŸÄ±n sorun olup olmadÄ±ÄŸÄ±na baÅŸka iÅŸlemler ile karar vereceÄŸim.

## Part 4. ArtÄ±k Ä°ncelemesi

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
sonuc<-lm(hwData$Y~hwData$X1+hwData$X2+hwData$X3+hwData$X4)
info <- ls.diag(sonuc)
info
```

#### AykÄ±rÄ± DeÄŸer (ri):

(-2,+2) aralÄ±ÄŸÄ±nda olmayan StandartlaÅŸtÄ±rÄ±lmÄ±ÅŸ hatalar, (-3,+3) arasÄ±nda olmayan Student tipi artÄ±klar aykÄ±rÄ± deÄŸerdir.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
aykiri <- list()
for (i in info$std.res){
  if (i<-2 & i>2){
    aykiri <- append(aykiri,which(info$std.res == i))
  }
}
aykiri

for (i in info$stud.res){
  if (i<-3 & i>3){
    aykiri <- appned(aykiri,which(info$std.dev == i))
  }
}
aykiri
```

`aykiri` isimli listemiz boÅŸ dÃ¶ndÃ¼. Gerek StandartlaÅŸtÄ±rÄ±lmÄ±ÅŸ hatalar gerekse Student tipi hatalarda aykÄ±rÄ± deÄŸer varlÄ±ÄŸÄ±na dair incelememizin sonucu olarak sÃ¶yleyebiliriz ki verilerimizde aykÄ±rÄ± deÄŸer yoktur. Normallik testinden sonra aykÄ±Ä±r deÄŸer temizliÄŸi yapmÄ±ÅŸtÄ±k zaten :)

#### Cook UzaklÄ±ÄŸÄ±(Di):

TÃ¼m gÃ¶zlemler Ã¼zerinden bulunan $\beta$ kestirimi ile i. gÃ¶zlem Ã§Ä±karÄ±ldÄ±ktan sonraki $\beta$ kestirimi arasÄ±ndaki farkÄ±n bir Ã¶lÃ§Ã¼sÃ¼dÃ¼r. AykÄ±rÄ± deÄŸerim olmadÄ±ÄŸÄ± iÃ§in aykÄ±rÄ± deÄŸerime iliÅŸkin Cook uzaklÄ±ÄŸÄ±nÄ± da bulamam.

## Part 5. Kestirim Denklemi

### Regresyon Analizi:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
sonuc<-lm(hwData$Y~hwData$X1+hwData$X2+hwData$X3+hwData$X4)
regression_model <- summary(sonuc)
regression_model
```

YukarÄ±daki sonuÃ§lardan yola Ã§Ä±karak;\
Elde edilen toplam gelirdeki deÄŸiÅŸimin %76,44'Ã¼ "*AraÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelirler*", "*Åirket hisse fiyatlarÄ±ndaki deÄŸiÅŸim*", "*Enflasyondaki deÄŸiÅŸim*" ve "*AraÃ§larÄ±n yakÄ±t tÃ¼rleri*" deÄŸiÅŸkenlerince aÃ§Ä±klanabilmektedir. AÃ§Ä±klanamayan kÄ±sÄ±m iÃ§in farklÄ± etkenler(deÄŸiÅŸkenler) olabilir.

### Model anlamlÄ±lÄ±ÄŸÄ±:

> H0: $\beta_1$ = $\beta_2$ = $\beta_3$ = $\beta_4$ = $\beta_5$\
> Hs: En az bir $\beta_j$ farklÄ±dÄ±r.

**`p-value: 2.2e-16` \<** $\alpha$=0.05 iÃ§in kÃ¼Ã§Ã¼k olduÄŸu iÃ§in %95 gÃ¼venle sÃ¶yleyebiliriz ki modelimiz anlamlÄ±dÄ±r.

### Regresyon model denklemi:

Model denklemini "$y_i=b0_{S_{b0}}+b_{k}X_{k_{S_{bk}}}$" formatÄ±nda

$y_i$ $= 5.4312_{(1.4467)} + 1.0369X1_{(0.2491)} + 2.3206X2_{(0.2844)} - 1.1229X3_{(0.2245)} - 3.7608X42_{(0.4027)} - 6.3051X43_{(0.3977)}$ $\pm 1.965$

Burada ilk baÅŸta ÅŸunu sÃ¶yleyebiliriz ki kÄ±lavuz deÄŸiÅŸkenimiz LPG ile Ã§alÄ±ÅŸan araÃ§lar deÄŸiÅŸkenidir. (X42=0 , X43=0)

## Part 6. KatsayÄ± AnlamlÄ±lÄ±klarÄ± ve YorumlarÄ±

### KÄ±smi F testleri:

> H0: $\beta_1$ = 0\
> Hs: $\beta_1$ $\neq$ 0

**`p-value: 5.44e-05`** $\alpha$=0.05 iÃ§in H0 reddedilir ve %95 gÃ¼venle sÃ¶ylenebilir ki araÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelirin modele katkÄ±sÄ± anlamlÄ±dÄ±r.

DiÄŸer tÃ¼m deÄŸiÅŸkenler sabit tutulduÄŸunda araÃ§ satÄ±ÅŸ ve kiralamadan gelen gelir 1 birim (1000TL) artarsa bizim gelirimizi ortalama olarak 1.0369 MilyonTL arttÄ±rÄ±r.

> H0: $\beta_2$ = 0\
> Hs: $\beta_2$ $\neq$ 0

**`p-value: 1.67e-13`** $\alpha$=0.05 iÃ§in H0 reddedilir ve %95 gÃ¼venle sÃ¶ylenebilir ki ÅŸirket hisse fiyatlarÄ±ndaki artÄ±ÅŸ veya azalÄ±ÅŸ, elde edilen toplam geliri aÃ§Ä±klamada Ã¶nemli bir deÄŸiÅŸkendir.

DiÄŸer tÃ¼m deÄŸiÅŸkenler sabit tutulduÄŸunda ÅŸirketimizin hisse fiyatlarÄ±ndaki 1 Lot 'luk (1 Birim) bir artÄ±ÅŸ toplam gelirimizi ortalama olarak aylÄ±k 2.3206 MilyonTL arttÄ±rÄ±r.

> H0: $\beta_3$ = 0\
> Hs: $\beta_3$ $\neq$ 0

**`p-value: 1.66e-06`** $\alpha$=0.05 iÃ§in H0 reddedilir ve %95 gÃ¼venle sÃ¶ylenebilir ki enflasyon etmeninin modele katkÄ±sÄ± anlamlÄ±dÄ±r.

DiÄŸer tÃ¼m deÄŸiÅŸkenler sabit tutulduÄŸunda enflasyondaki %1 'lik bir artÄ±ÅŸ gelirimizi aylÄ±k ortalama olarak 1.1229 MiyonTL azaltÄ±r.

> H0: $\beta_4$ = 0 Hs: $\beta_4$ $\neq$ 0

**`p-value: 2e-16`** $\alpha$=0.05 iÃ§in H0 reddedilir ve %95 gÃ¼venle sÃ¶ylenebilir ki araÃ§ yakÄ±t tÃ¼rÃ¼ kategorik deÄŸiÅŸkenindeki LPG'li araÃ§lar ile benzinle Ã§alÄ±ÅŸan araÃ§lar arasÄ±nda farklÄ±lÄ±k vardÄ±r.

> H0: $\beta_4$ = 0 Hs: $\beta_4$ $\neq$ 0

**`p-value: 2e-16`** $\alpha$=0.05 iÃ§in H0 reddedilir ve %95 gÃ¼venle sÃ¶ylenebilir ki X4 kategorik deÄŸiÅŸkenindeki LPG'li araÃ§lar ile dizel ile Ã§alÄ±ÅŸan araÃ§lar arasÄ±nda farklÄ±lÄ±k vardÄ±r.

AraÃ§ yakÄ±t tÃ¼rlerine baktÄ±ÄŸÄ±mÄ±zda LPG ile Ã§alÄ±ÅŸan araÃ§lar, benzin ve dizel ile Ã§alÄ±ÅŸan araÃ§lardan farklÄ±dÄ±r. AyrÄ±ca amacÄ±mÄ±z elde edilen geliri maksimize etmeye Ã§alÄ±ÅŸmak olduÄŸundan dolayÄ±, bizim iÃ§in LPG'li araÃ§lar diÄŸer araÃ§lardan daha karlÄ±dÄ±r diyebiliriz.

## Part 7. Belirtme KatsayÄ±sÄ±

O ay elde edilen toplam gelirin %76,44 'Ã¼ araÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir, ÅŸirket hisselerindeki fiyat deÄŸiÅŸimi, enflasyondaki deÄŸiÅŸim ve kiralanan veya satÄ±lan araÃ§lara iliÅŸkin yakÄ±t tÃ¼rÃ¼ gibi deÄŸiÅŸkenlerce aÃ§Ä±klanabilmektedir. Geriye kalan %23,56 'lÄ±k kÄ±sÄ±m ise elimizde olmayan etmenlerce aÃ§Ä±klanabilmektedir.

## Part 8. GÃ¼ven AralÄ±klarÄ±

### KatsayÄ±lara iliÅŸkin gÃ¼ven aralÄ±klarÄ±:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
confint(sonuc, level = .99)
```

%99 gÃ¼venirlikle hesaplanan bu gÃ¼ven aralÄ±klarÄ± modelimizdeki deÄŸiÅŸkenlerimizin aylÄ±k gelirimize olan etkilerinin ortalama olarak hangi aralÄ±kta olduÄŸunu gÃ¶stermektedir.

-   **(X1)** AraÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir 1 birim (1000TL) artarsa eÄŸer diÄŸer deÄŸiÅŸkenler sabit tutulduÄŸunda bizim gelirimizi 386.52,1TL ile 1.687.273,7TL arttÄ±rmaktadÄ±r.

-   **(X2)** Hisse senetlerindeki durumda ise yine aynÄ± ÅŸekilde diÄŸer deÄŸiÅŸkenlerin sabit tutulmasÄ± koÅŸuluyla hisse senetlerimizdeki 1 birimlik artÄ±ÅŸ (1Lot baÅŸÄ±na 1TL 'lik artÄ±ÅŸ) aylÄ±k gelirimizi 1.578.060,4TL ile 3.063.117,5TL arasÄ±nda bir deÄŸerde arttÄ±rmaktadÄ±r.

-   **(X3)** DiÄŸer tÃ¼m deÄŸiÅŸkenler sabit tutulduÄŸunda enfasyondaki %1 lik bir artÄ±ÅŸ bizim gelirimizi 1.709.024,9TL ile 536.711,3 TL arasÄ±nda bir deÄŸerde azalmaktadÄ±r.

-   **(X4)** Kategorik deÄŸiÅŸkenlerimiz hususunda ise diÄŸer deÄŸiÅŸkenlerimiz sabitse, aracÄ±n benzinle Ã§alÄ±ÅŸmasÄ± aylÄ±k geliri 4.812.248,7TL ile 2.709.427,9TL arasÄ±nda, dizel ile Ã§alÄ±ÅŸmasÄ± aylÄ±k geliri 7.343.556,1TL ile 5.266.723,6TL azaltmaktadÄ±r.

## Part 9. DeÄŸiÅŸen VaryanslÄ±lÄ±k Ä°ncelemesi

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
plot(predict(sonuc), info$stud.res, ylab= "Student tipi ArtÄ±klar", xlab="Ã–ngÃ¶rÃ¼len deÄŸer")
```

Student tipi artÄ±klar ile Ã¶ngÃ¶rÃ¼len deÄŸerlere iliÅŸkin saÃ§Ä±lÄ±m grafiÄŸini incelediÄŸimizde yapÄ±nÄ±n rastgele olduÄŸunu sÃ¶yleyebiliriz. Burdan yola Ã§Ä±karak ArtÄ±klarÄ±n rastgele daÄŸÄ±ldÄ±ÄŸÄ± yorumunu yapabiliriz.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(lmtest)
bptest(sonuc)
```

AyrÄ±ca Breusch-Pagan testi sonucuna gÃ¶re;

> H0: DeÄŸiÅŸen varyanslÄ±lk vardÄ±r.\
> Hs: DeÄŸiÅŸen varyanlÄ±lÄ±k yoktur.

\
**`p-value = 0.1063` \>** $\alpha$=0.05 iÃ§in yokluk hipotezi reddedilemez yani deÄŸiÅŸen varyanslÄ±lÄ±k sorunu yoktur.

## Part 10. Ã–z Ä°liÅŸki Sorunu

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(lmtest)
dwtest(sonuc)
```

Model Ã¶zeti tablosundan **"d=1.0031"** bulunmuÅŸtur. **"d=2(1-r)"** formÃ¼lÃ¼ dikkate alÄ±ndÄ±ÄŸÄ±nda ve tablodan d~lower~ ve d~upper~ deÄŸerleri alÄ±nÄ±p bir tablo oluÅŸturulduÄŸunda *(k=4 ve n=147 iÃ§in)*:

|  Variable  | Value  |
|:----------:|:------:|
| *d~lower~* | *1.68* |
| *d~upper~* | *1.79* |

Tablodan yola Ã§Ä±karak **[1.68 ; 1.79]** aralÄ±ÄŸÄ± bizim iÃ§in kararsÄ±zlÄ±k bÃ¶lgesidir. Ancak elimizdeki Durbin-Watson deÄŸerimiz `DW = 1.0031` bu kararsÄ±zlÄ±k bÃ¶lgesinde yer almadÄ±ÄŸÄ± ve **[0;2]** aralÄ±ÄŸÄ±nda yer aldÄ±ÄŸÄ± iÃ§in Ã¶z iliÅŸki vardÄ±r deriz. Buna ek olarak kuracaÄŸÄ±mÄ±z seÃ§enek hipotezimizde ise pozitif yÃ¶nlÃ¼ kurmalÄ±yÄ±z:

> H~o~ = Ã–z iliÅŸki yoktur.\
> H~s~ = Pozitif Ã¶z iliÅŸki vardÄ±r.

Durbin-Watson test sonucunda elde ettiÄŸimiz `p-value = 1.758e-10` **\<** $\alpha$=0.05 deÄŸerleri iÃ§in sÃ¶yleyebiliriz ki, %95 gÃ¼venle pozitif Ã¶z iliÅŸki vardÄ±r.\

## Part 11. Ã‡oklu BaÄŸlantÄ± Sorunu

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library("Hmisc")
res2 <- rcorr(as.matrix(hwData[2:5]))
res2$r
```

DeÄŸiÅŸkenlerimizin arasÄ±ndaki iliÅŸki incelendiÄŸinde, X1 ve X2 arasÄ±nda yÃ¼ksek bir iliÅŸki olduÄŸu gÃ¶rÃ¼lmekte. Bu durumda Ã§oklu baÄŸlantÄ± olabilir. Bir diÄŸer korelasyon inceleme yÃ¶ntemi olarak:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
cor(hwData[2:4], method = "pearson")
```

Bu ÅŸekilde de X1 ve X2 arasÄ±nda yÃ¼ksek bir iliÅŸki olduÄŸunu sÃ¶yleyebiliriz fakat bakalÄ±m bu iliÅŸki dÃ¼zeyi bizi etkiliyor mu?

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(DAAG)
vif(sonuc)
```

`vif()` ile Ã§oklu baÄŸlantÄ± var mÄ± diye baktÄ±ÄŸÄ±mda o kadar da bÃ¼yÃ¼k vif deÄŸerleri elde edemedim, Ã§oklu baÄŸlantÄ± sorunu olabilir diyebilmek iÃ§in.

Son olarak bu sorulara cevap verebilmek, Ã§oklu baÄŸlantÄ± sorunu vardÄ±r veya yoktur diyebilmek iÃ§in `colldiag()` ve `ols_eigen_cindex()` fonksiyonlarÄ±nÄ± kullandÄ±m. Ä°ki yÃ¶ntemi de gÃ¶stermek istedim:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(perturb)
colldiag(model.matrix(sonuc),add.intercept=FALSE)

library(olsrr)
ols_eigen_cindex(sonuc)
```

KoÅŸul sayÄ±sÄ± 30'dan bÃ¼yÃ¼k olduÄŸu durumda Ã§oklu baÄŸlantÄ±dan etkilenilmektedir. Fakat bizim yÃ¼ksek derecede korelasyona sahip baÄŸÄ±msÄ±z deÄŸiÅŸkenlerimiz olsa da Ã§oklu baÄŸlantÄ± sorunu var diyebileceÄŸimiz deÄŸiÅŸkenler deÄŸilmiÅŸ. Ã‡Ã¼nkÃ¼ KoÅŸul baÅŸlÄ±ÄŸÄ± altÄ±ndaki deÄŸerlerin hiÃ§biri 30'dan bÃ¼yÃ¼k deÄŸil.

## Part 12. Uyum Kestirimi

Veri kÃ¼mesindeki $x_i$ deÄŸerlerine karÅŸÄ±lÄ±k gelen $y_i$ kestirimi, *uyum kestirimi* adÄ±nÄ± alÄ±r.\
Bu tanÄ±ma iliÅŸkin $y_i$ kestirimini yapmak Ã¼zere "*X1=6.473778 , X2=0.50627316, X3=-0.028457406 , X42=0 , X43=0*" deÄŸerlerini aldÄ±m.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
names(hwData) <- c("y","x1","x2","x3","x4")
attach(hwData)

library(fastDummies)
dummy<-dummy_cols(x4)
x41<-dummy$.data_1
x42<-dummy$.data_2
x43<-dummy$.data_3

kestirim <- cbind(x1,x2,x3,x42,x43)
yi <- 5.4312 + 1.0369*6.473778 + 2.3206*0.50627316 - 1.1229*0.028457406
yi-1.965
yi+1.965
```

Kestirim denklemi ile hesaplanarak %95 gÃ¼venle **[11.32176;15.25176]** sonucu bulunur.\
Yani, araÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir 6.473778 BinTL, hisse senetleri 0.50627316TL ve enflasyon %0.028457406 azaldÄ±ÄŸÄ±nda LPG'li bir aracÄ±n aylÄ±k olarak bize getirisi ortalama 11.32176 MilyonTL ile 15.25176 MilyonTL arasÄ±nda olacaktÄ±r.

## Part 13. Ã–n Kestirim

Veri kÃ¼mesinde bulunmayan yeni $\tilde{x}_i$ gÃ¶zlemleri iÃ§in $\tilde{y}$ deÄŸerinin kestirimi, Ã¶nkestirim adÄ±nÄ± alÄ±r.\
Ã–nkestirimini yapmak Ã¼zere "*X1=11 , X2=-2 , X3=-2.5 , X42=1 , X43=0"* deÄŸerlerini aldÄ±m.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
yi <- 5.4312 + 1.0369*11 - 2.3206*2 + 1.1229*2.5
yi-1.965
yi+1.965
```

%95 gÃ¼venle **[13.03815;16.96815]** sonucu bulunur.\
Yani, araÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir 11 BinTL arttÄ±ÄŸÄ±nda, hisse senetleri 2TL deÄŸer kaybettiÄŸinde ve enflasyon %2.5 azaldÄ±ÄŸÄ±nda benzinle Ã§alÄ±ÅŸan bir aracÄ±n aylÄ±k olarak bize getirisi ortalama 13.038,15TL ile 16.968,15TL arasÄ±nda olacaktÄ±r.

## Part 14. Uyum ve Ã–n Kestirime Ä°liÅŸkin Beklenen DeÄŸerlerin GÃ¼ven AralÄ±klarÄ±

#### Uyum kestirimi iÃ§in:

P($\hat{y_i}$ - $t_{\frac{\alpha}{2},n-k-1}$ - $S_{\hat{y}_i}$ $\le$ E($\hat{y_i}$) $\le$ $\hat{y_i}$ + $t_{\frac{\alpha}{2},n-k-1}$ - $S_{\hat{y}_i}$) = 1 - $\alpha$

$S\hat{y}$ = $\hat{\sigma}$ $\sqrt{\underline{x}_{i} (X'X)^{-1} \underline{x}'_{i}}$


```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
predict(sonuc,interval="confidence", level=0.95)[13,]
```
\
`predict()` kodunu kullanmak iÃ§in linear model olan "sonuc" deÄŸiÅŸkenimi iÃ§ine attÄ±m, uyum kestirimine iliÅŸkin gÃ¼ven aralÄ±ÄŸÄ± elde etmek iÃ§in `interval="confidence"` olarak belirttim ve son olarak gÃ¼ven aralÄ±ÄŸÄ±nÄ± `level=0.95` olarak belirttim. Uyum kestirimi deÄŸerleri de veri setimin 12. satÄ±rÄ± olduÄŸu iÃ§in 13. satÄ±rÄ± belirttim.\
SonuÃ§ olarak "*X1=6.473778 , X2=0.50627316, X3=-0.028457406 , X42=0 , X43=0*" deÄŸerlerinde uyum kestirimine iliÅŸkin gÃ¼ven aralÄ±ÄŸÄ±nÄ± %95 gÃ¼venle [12.57582;14.12547] olarak buldum.\

"%95 gÃ¼venle sÃ¶ylenebilir ki araÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir 6.473778 BinTL arttÄ±ÄŸÄ±nda, hisse senetleri 0.50627316 TL deÄŸerlendiÄŸinde ve enflasyon %0.028457406 azaldÄ±ÄŸÄ±nda LPG'yle Ã§alÄ±ÅŸan bir aracÄ±n aylÄ±k olarak bize getirisi nin beklenen deÄŸeri ortalama 12.57582 MilyonTL ile 14.12547 MilyonTL arasÄ±nda olacaktÄ±r."
\

#### Ã–n kestirim iÃ§in:

P($\tilde{y}$ - $t_{\frac{\alpha}{2},n-k-1}$ - $S_{\tilde{y}}$ $\le$ E($\tilde{y}$) $\le$ $\tilde{y}$ + $t_{\frac{\alpha}{2},n-k-1}$ - $S_{\tilde{y}}$

$S\tilde{y}$ = $\hat{\sigma}$ $\sqrt{1 + \underline{\tilde{x}} (X'X)^{-1} \underline{\tilde{x}}'}$

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
predict(sonuc,data.frame(x1=11, x2=-2, x3=-2.5),interval="prediction", level=0.95)[13,]
```
Ã–n kestirimi yapmak Ã¼zre "*X1=6.473778 , X2=0.50627316, X3=-0.028457406 , X42=0 , X43=0*" deÄŸerlerini aldÄ±m ve sonucunda %95 gÃ¼venle elde ettiÄŸim gÃ¼ven aralÄ±ÄŸÄ±;

[9.389428;17.311855]\
Buradan hareketle yorumumuzu "%95 gÃ¼venle sÃ¶ylenebilir ki araÃ§ satÄ±ÅŸÄ± ve kiralamadan gelen gelir 11 BinTL arttÄ±ÄŸÄ±nda, hisse senetleri 2TL deÄŸer kaybettiÄŸinde ve enflasyon %2.5 azaldÄ±ÄŸÄ±nda benzinle Ã§alÄ±ÅŸan bir aracÄ±n aylÄ±k olarak bize getirisi nin beklenen deÄŸeri ortalama 9.389428 MilyonTL ile 17.311855 MilyonTL arasÄ±nda olacaktÄ±r."


## Part 15. En Ä°yi Model

### Ä°leriye doÄŸru seÃ§im yÃ¶ntemi:

Bu yÃ¶ntem, hiÃ§ bir baÄŸÄ±msÄ±z deÄŸiÅŸkenin bulunmadÄ±ÄŸÄ± regresyon denklemine (y = ğ›½0 + $\epsilon$) deÄŸiÅŸkenlerin her adÄ±mda tek tek eklenmesiyle uygulanÄ±r.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(stats)
attach(hwData)
null_model <- lm(y ~ 1)
ileri <- step(null_model,y~x1+x2+x3+x4,  direction = "forward")
ileri
```

\
BaÄŸÄ±mlÄ± deÄŸiÅŸken $y$ olduÄŸu durumda birinci adÄ±mda $x_4$ modele deÄŸiÅŸkeni girmiÅŸtir. Daha sonra ikinci adÄ±mda $x_2$ deÄŸiÅŸkeni modele girmiÅŸtir. 3. AdÄ±mda $x_3$ deÄŸiÅŸkeni, 4. adÄ±mda ise $x_1$ deÄŸiÅŸkeni modele girmiÅŸtir.\
Demek ki tÃ¼m deÄŸiÅŸkenler modelde anlamlÄ± olduÄŸu iÃ§in tÃ¼m deÄŸiÅŸkenler modelimizde yer almÄ±ÅŸtÄ±r.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
summary(ileri)
```

YukarÄ±daki Ã§Ä±ktÄ±mÄ±zdaki p deÄŸerlerinden de gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ Ã¼zere tÃ¼m deÄŸiÅŸkenlerimizin modele katkÄ±sÄ± %99 gÃ¼ven dÃ¼zeyinde bile anlamlÄ±dÄ±r.

AyrÄ±ca model de anlamlÄ±dÄ±r (`p-value: < 2.2e-16` \< $\alpha = 0.05$)

En iyi model: Â Â Â format($y_i=\beta0_{S_{\beta0}}+\beta1x1_{S_{\beta1}}$)

$$
y_i=5.4312_{1.4467} - 3.7608X42_{0.4027} - 6.3051X43_{0.3977} + 2.3206X2_{0.2844} - 1.1229X3_{0.2245} + 1.0369X1_{0.2491} Â± 1.965
$$\
\### Geriye doÄŸru seÃ§im yÃ¶ntemi: Bu yÃ¶ntem, tÃ¼m deÄŸiÅŸkenlerin bulunduÄŸu regresyon denkleminden, deÄŸiÅŸkenlerin her adÄ±mda tek tek Ã§Ä±kartÄ±lmasÄ±yla uygulanÄ±r.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
geri <- step(sonuc, direction = "backward")

```

\
Geriye doÄŸru seÃ§im yÃ¶nteminin Ã¶zelliÄŸinden tÃ¼m deÄŸiÅŸkenler modelde olarak baÅŸlÄ±yor. Ä°lk model ve ayrÄ±ca son model tÃ¼m baÄŸÄ±msÄ±z deÄŸiÅŸkenlerin modelde bulunduÄŸu durumdur ki o ÅŸekilde de kalmÄ±ÅŸtÄ±r.\

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
summary(geri)
```

\
YukarÄ±daki Ã§Ä±ktÄ±mÄ±zdan anlaÅŸÄ±lan o ki deÄŸiÅŸkenlerimizin hepsi anlamlÄ± deÄŸiÅŸkenler.\
(p-value deÄŸerlerinin hepsi $\alpha=0.05$ 'ten kÃ¼Ã§Ã¼k)\
\
Geriye doÄŸru seÃ§im yÃ¶ntemi de ileriye doÄŸru seÃ§im yÃ¶ntemi ile aynÄ± sonucu verdi.\
En iyi modelde tÃ¼m deÄŸiÅŸkenlerimiz var ayrÄ±ca modelimiz de anlamlÄ±.\
\
\### AdÄ±msal SeÃ§im YÃ¶ntemi: AdÄ±msal regresyon yÃ¶ntemi, ileriye doÄŸru seÃ§im ve geriye doÄŸru Ã§Ä±karma yÃ¶ntemlerinin aynÄ± anda kullanÄ±lmasÄ±yla uygulanÄ±r.

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(MASS)
wise_model <- stepAIC(sonuc, direction = "both" ,trace="FALSE")
summary(wise_model)
detach(hwData)
```

\
AdÄ±msal seÃ§im yÃ¶ntemimiz de diÄŸer iki yÃ¶ntemimizden farksÄ±z olarka tÃ¼m deÄŸiÅŸkenlerimizi anlamlÄ± buldu ve en iyi model seÃ§imimize ekledi.\
En iyi modelimiz tÃ¼m deÄŸiÅŸkenlerimizin bulunduÄŸu Ã¶nceki modelimizle aynÄ±dÄ±r. AyrÄ±ca modelimiz de anlamlÄ±dÄ±r.\

## Part 16. Ridge Regresyon

Ridge Regresyon Ã§oklu baÄŸlantÄ± sorunlarÄ±nÄ±n oluÅŸmasÄ±nda Ã§alÄ±nan bir kapÄ±dÄ±r. Benim Ã§oklu baÄŸlantÄ± sorunum yok ama hocalarÄ±mÄ±z yine de bu kapÄ±yÄ± Ã§almamÄ±zÄ± istiyor. Genelde cevabÄ±nÄ± bildiÄŸim sorular sormam konusunda kÄ±zÄ±yorlar ama...\
Ã‡alalÄ±m bakalÄ±m cevabÄ±nÄ± bilsek ise...\

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
attach(hwData)
ridge <- lm.ridge(y~x1+x2+x3+x4 , lambda = seq(0,1,0.05))

matplot(ridge$lambda,
        t(ridge$coef),
        type="s",
        lwd=2,
        lty=1,
        xlab=expression(lambda),
        ylab=expression(hat(beta)))
abline(h=0,lwd=2)

```

\
HÄ±zlÄ± artÄ±ÅŸ ya da azalÄ±ÅŸ gÃ¶steren katsayÄ±lara karÅŸÄ±lÄ±k gelen deÄŸiÅŸkenler Ã§oklu baÄŸlantÄ±lÄ± deÄŸiÅŸkenlerdir.\
AyrÄ±ca sÄ±fÄ±r eksenin civarÄ±nda seyreden deÄŸiÅŸkenler de modelde Ã¶nemsiz deÄŸiÅŸkeni gÃ¶stermektedir.\
\
Ama gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ Ã¼zere mis gibi gÃ¼nahsÄ±z alkolsÃ¼z sim suyuyla yÄ±kanmÄ±ÅŸ gibi bir grafiÄŸimiz var ne "Ã§oklu baÄŸlantÄ± sorunu var ya bunda" dedirtir, ne de "ÅŸu deÄŸiÅŸken Ã¶nemsiz gibi mi duruyor" gibi ÅŸÃ¼pheye dÃ¼ÅŸÃ¼rtÃ¼r.\
\
Analizimizin Ã¶nceki adÄ±mlarÄ±nda da yaptÄ±ÄŸÄ±mÄ±z Ã¼zre sÃ¶yleyebiliriz ki Ã§oklu baÄŸlantÄ± sorunu yoktur ve hiÃ§ bir deÄŸiÅŸkenimiz 0 ekseni civarÄ±nda da seyretmiyor.\
Bu da sayÄ±sal aÃ§Ä±klamasÄ±:

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
ridge$coef[,ridge$lam == 0.4]
```
